<!doctype html>
<!-- © 2025 DinnerMath — Calculator code and design are proprietary. Licensed for end-user viewing only via comesail.github.io. -->
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>DinnerMath — Cobblers, Crisps, and Crumbles Quantity Calculator (Tenderloin ultratight)</title>
<meta name="description" content="How much cobbler, crisp, or crumble per person? Estimate pans to bake and about total servings, with optional pricing and quick presets.">
<style>
  :root{ --ink:#111827; --muted:#6b7280; --line:#e5e7eb; --bg:#ffffff; --card:#ffffff; }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0}
  body{background:var(--bg);color:var(--ink);font-family:"Inter",ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial}
  .wrap{max-width:740px;margin:0 auto;padding:clamp(8px,1.6vw,14px)}
  .dm-card{background:var(--card);border:1px solid var(--line);border-radius:0px;padding:10px;margin:8px 0;box-shadow:0 1px 0 rgba(17,24,39,.06),0 1px 2px rgba(17,24,39,.05)}
  h1{font-size:20px;margin:0 0 6px;text-align:center;font-weight:800}
  h3{font-size:15px;margin:0 0 6px;text-align:center;font-weight:800}
  .lede{color:var(--muted);margin:0 0 8px;text-align:center;font-weight:400;font-size:12.5px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:6px}
  @media (max-width:820px){.row{grid-template-columns:1fr}}
  label{font-size:10.5px;color:#374151;display:block;margin:0 0 2px;font-weight:600;text-align:left}
  input[type="number"],select{width:100%;border:1px solid #d1d5db;border-radius:7px;padding:6px 8px;font-size:12.5px;line-height:1.2;background:#fff;color:var(--ink)}
  .muted{color:var(--muted);font-size:11px}
  .fine{font-size:12.5px;color:#374151;line-height:1.35}
  .inline{display:flex;align-items:center;gap:6px;flex-wrap:wrap}
  .divider{height:1px;background:var(--line);margin:8px 0}
  .btn{display:inline-block;border:1.5px solid var(--ink);border-radius:999px;padding:6px 10px;font-size:12.5px;font-weight:700;text-decoration:none;color:var(--ink);cursor:pointer;background:#fff}
  .btn:hover{background:#f3f4f6}
  .btn:focus-visible, .preset:focus-visible, .linklike:focus-visible{outline:3px solid #94a3b8;outline-offset:2px}
  .pill{font-size:10px;border:1px solid #d1d5db;border-radius:999px;padding:2px 6px;color:#475569;background:#fff;text-decoration:none}
  .preset{border:2px solid var(--ink);background:#f8fafc;border-radius:999px;padding:5px 10px;font-size:13px;font-weight:800;cursor:pointer}
  .preset:hover{background:#eef2f7}
  .result{border:2px solid var(--ink);border-radius:0px;padding:10px;margin-top:6px;background:#fff}
  .result .big{font-size:24px;font-weight:800;line-height:1.2;color:var(--ink);font-variant-numeric:tabular-nums}
  .finder{padding:8px;border-radius:0px;border:2px solid var(--ink);background:#fff}
  .visually-hidden{position:absolute!important;clip:rect(1px,1px,1px,1px);clip-path:inset(50%);height:1px;width:1px;overflow:hidden;white-space:nowrap;border:0;padding:0;margin:-1px}
  [aria-label="Guests"]{display:flex;flex-wrap:wrap;gap:6px;align-items:flex-end}
  [aria-label="Guests"]>div{flex:0 0 auto}
  #A,#T,#C{width:110px}
  [aria-label="Guests"]>div:nth-child(4){flex:1 1 240px;min-width:220px}
  .row-2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  @media (max-width:820px){ .row-2{grid-template-columns:1fr} }
  a, a:visited{color:var(--ink)}
  .linklike{font-size:11px; color:#374151; text-decoration:underline; cursor:pointer; background:none; border:none; padding:0}
</style>
</head>
<body class="ultra">
  <div class="wrap" id="cobbler">

    <!-- Header -->
    <div class="dm-card" role="region" aria-label="Header">
      <h1>Cobblers, Crisps, and Crumbles Quantity Calculator — Pans per Person</h1>
      <p class="lede">
        Enter guests and settings (or tap a quick preset). We will estimate how many <strong>pans</strong> to bake (planning estimate).
      </p>
    </div>

    <!-- Inputs -->
    <div class="dm-card" role="region" aria-label="Inputs">
      <h3>Inputs</h3>
      <div class="row" aria-label="Guests">
        <div><label for="A">Adults</label><input id="A" type="number" min="0" step="1" inputmode="numeric" value="10" autofocus></div>
        <div><label for="T">Teens</label><input id="T" type="number" min="0" step="1" inputmode="numeric" value="0"></div>
        <div><label for="C">Children</label><input id="C" type="number" min="0" step="1" inputmode="numeric" value="0"></div>
        <div>
          <label for="course">Course mode</label>
          <select id="course">
            <option value="dessert" selected>Dessert plate</option>
            <option value="party">Sweets table (party)</option>
            <option value="tasting">Coffee break or tasting</option>
          </select>
        </div>
      </div>

      <div class="row" aria-label="Context">
        <div>
          <label for="length">Event length</label>
          <select id="length">
            <option value="0.95">Short - about 1 to 2 hours</option>
            <option value="1.00" selected>Standard - about 2 to 3 hours</option>
            <option value="1.08">Long - about 3 to 4 hours</option>
            <option value="1.15">Extended - about 4 to 5 hours</option>
          </select>
        </div>
        <div>
          <label for="leftovers">Add leftovers</label>
          <select id="leftovers">
            <option value="1.00" selected>No</option>
            <option value="1.07">+7%</option>
            <option value="1.12">+12%</option>
          </select>
        </div>
        <div>
          <label for="appetite">Appetite</label>
          <select id="appetite">
            <option value="0.90">Light</option>
            <option value="1.00" selected>Typical</option>
            <option value="1.15">Sweet tooth</option>
          </select>
        </div>
        <div>
          <label for="portion">Portion size</label>
          <select id="portion">
            <option value="0.90">Small bowl (3/4 cup)</option>
            <option value="1.00" selected>Standard bowl (1 cup)</option>
            <option value="1.20">Generous bowl (1 1/4 cups)</option>
          </select>
        </div>
      </div>

      <div class="inline" style="margin-top:6px">
        <span class="muted">Quick presets:</span>
        <button class="preset" data-people="10" type="button">10</button>
        <button class="preset" data-people="25" type="button">25</button>
        <button class="preset" data-people="50" type="button">50</button>
        <button class="preset" data-people="100" type="button">100</button>
        <span class="muted">Presets set all as adults. Tweak Teens and Children if needed.</span>
        <div style="flex:1"></div>
        <button id="dmReset" type="button" class="btn">Reset</button>
      </div>
    </div>

    <div class="muted" id="outMicro" style="margin:6px 0 0 0">-</div>

    <!-- Results -->
    <div class="dm-card" role="region" aria-label="Results" aria-live="polite" aria-atomic="true">
      <h3>Results (estimate)</h3>
      <div class="result">
        <div class="muted" aria-hidden="true">Estimated pans to bake</div>
        <div class="big" id="outBig" aria-label="No estimate yet">-</div>
        <div class="fine">About <span id="outServings">-</span> total serving(s)</div>
        <div class="fine" id="outFrom">-</div>
        <div class="fine muted" id="outBatchNote"></div>
        <div class="divider"></div>
        <div class="inline">
          <span class="pill" id="pillGuests">-</span>
          <span class="pill" id="pillPan">-</span>
          <span class="pill" id="pillPrice">pricing optional</span>
        </div>
        <div class="fine" id="planLine" style="margin-top:8px">-</div>
        <div class="fine" id="altWrap" style="margin-top:4px; display:none">
          <button id="toggleAlt" class="linklike" type="button" aria-expanded="false" aria-controls="altLine">Show other options</button>
          <div id="altLine" style="margin-top:4px; display:none">-</div>
        </div>
      </div>

      <div class="row-2" style="margin-top:10px">
        <div class="dm-card" style="margin:0">
          <h3>Cost estimate</h3>
          <div class="inline">
            <div><label>Subtotal</label><div id="outSubtotal" class="fine">$-</div></div>
            <div><label>Tax and fees</label><div id="outAdds" class="fine">$-</div></div>
            <div><label>Estimated total</label><div id="outTotal" class="fine">$-</div></div>
            <div><label>Per person</label><div id="outPPP" class="fine">$-</div></div>
          </div>
        </div>
        <div class="dm-card finder" role="region" aria-label="Find near me" style="margin:0">
          <div class="inline">
            <a class="btn" href="#" onclick="try{window.open('https://www.google.com/maps/search/cobbler+near+me','_blank');}catch(e){location.href='https://www.google.com/maps/search/cobbler+near+me';}return false;">Find cobbler near me</a>
            <a class="pill" href="#" onclick="try{window.open('https://www.google.com/maps/search/bakery','_blank');}catch(e){location.href='https://www.google.com/maps/search/bakery';}return false;">Bakeries</a>
            <a class="pill" href="#" onclick="try{window.open('https://www.google.com/maps/search/grocery+store','_blank');}catch(e){location.href='https://www.google.com/maps/search/grocery+store';}return false;">Grocery stores</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Pricing -->
    <div class="dm-card" role="region" aria-label="Pricing">
      <h3>Pricing (optional)</h3>
      <div class="row">
        <div><label for="priceMode">Pricing mode</label>
          <select id="priceMode">
            <option value="pan" selected>Per pan</option>
            <option value="serving">Per serving</option>
          </select>
        </div>
        <div><label for="priceUnit">Unit price</label><input id="priceUnit" type="number" min="0" step="0.01" inputmode="decimal" placeholder="Example: 12.99"></div>
        <div><label for="taxPct">Sales tax (percent)</label><input id="taxPct" type="number" min="0" step="0.1" inputmode="decimal" placeholder="Example: 7.5"></div>
        <div><label for="fees">Extra fees (US dollars)</label><input id="fees" type="number" min="0" step="0.01" inputmode="decimal" placeholder="Example: 10.00"></div>
      </div>
      <div class="muted">Subtotal equals rounded quantity times unit price for the selected mode, plus sales tax and fees.</div>
    </div>

  </div>

  <script>
  (function(){
    const $=id=>document.getElementById(id);
    const N=(v,d=0)=>{const n=parseFloat(v);return isFinite(n)?n:d;};
    const money=n=>(isFinite(n)&&n>=0)?"$"+n.toFixed(2):"$-";

    // Select-all on click and focus for A/T/C
    ["A","T","C"].forEach(id=>{
      const el=$(id);
      ["focus","click"].forEach(ev=>el.addEventListener(ev,()=>{try{el.select();}catch(e){}}));
    });

    // Portion multiplier relative to a standard bowl
    const portionMult = v => (v==="0.90"?0.90:(v==="1.20"?1.20:1.00));

    // Course multiplier to mod dessert demand
    function courseMult(c){
      if(c==="party") return 1.15;
      if(c==="tasting") return 0.85;
      return 1.00;
    }

    // Best pan mix — prefer 9x13 for moderate batches; 8x8 only for small (<=12); allow half-sheet for large
    function bestPanMix(needServings){
      needServings = Math.max(0, Math.ceil(needServings));
      let best = null;
      const maxHalf = Math.ceil(needServings/30)+1;
      for(let h=0; h<=maxHalf; h++){
        const remH = needServings - h*30;
        const maxLarge = Math.ceil(Math.max(0,remH)/15)+1;
        for(let l=0; l<=maxLarge; l++){
          const remL = needServings - h*30 - l*15;
          const s = remL>0 ? Math.ceil(remL/9) : 0;
          const totalServ = h*30 + l*15 + s*9;
          const pans = h + l + s;
          const over = totalServ - needServings;
          if(totalServ>=needServings){
            const smallPenalty = (needServings > 12) ? (s * 3) : 0; // discourage clusters of 8x8 beyond tiny batches
            const cand = {h,l,s,totalServ,pans,over,score:over + smallPenalty};
            if(!best
              || cand.score < best.score
              || (cand.score===best.score && cand.pans < best.pans)
              || (cand.score===best.score && cand.pans===best.pans && (h>best.h || (h===best.h && l>best.l)))
            ){
              best = cand;
            }
          }
        }
      }
      return best || {h:0,l:0,s:0,totalServ:0,pans:0,over:0,score:0};
    }

    function mixToText(m){
      const parts = [];
      if(m.h) parts.push(m.h + " half-sheet pan" + (m.h>1?"s":""));
      if(m.l) parts.push(m.l + " 9x13 pan" + (m.l>1?"s":""));
      if(m.s) parts.push(m.s + " 8x8 pan" + (m.s>1?"s":""));
      return parts.length?parts.join(" and "):"0 pans";
    }

    function compute(){
      const A=N($("A").value,0), T=N($("T").value,0), C=N($("C").value,0);
      const guests=A+T+C;
      const appetite=N($("appetite").value,1.0);
      const leftovers=N($("leftovers").value,1.0);
      const length=N($("length").value,1.0);
      const course=$("course").value;
      const portion=$("portion").value;

      // Adult-equivalents
      const AE = A + 0.8*T + 0.6*C;

      // Baseline: 1 standard bowl per AE, scaled
      const servings = AE * portionMult(portion) * appetite * length * leftovers * courseMult(course);

      const mix = bestPanMix(servings);
      const pans = mix.h + mix.l + mix.s;
      const servingsRounded = Math.ceil(Math.max(0, servings));

      return {guests, AE, servingsRounded, pans, mix, course, appetite, length, leftovers, portion};
    }

    function shouldShowAlternatives(need, best){
      if(!best) return false;
      const overPct = best.totalServ>0 ? (best.over / best.totalServ) : 0;
      return (overPct >= 0.20) || ((best.totalServ - need) >= 6);
    }

    function altPlans(need, best){
      const alts=[]; const cap=(m)=>m.h*30+m.l*15+m.s*9;
      for(let dh=-1; dh<=1; dh++){
        for(let dl=-2; dl<=2; dl++){
          for(let ds=-2; ds<=2; ds++){
            const m={h:Math.max(0,best.h+dh), l:Math.max(0,best.l+dl), s:Math.max(0,best.s+ds)};
            const total = cap(m); const pans=m.h+m.l+m.s;
            if(total<=0 || total<need) continue;
            if(m.h===best.h && m.l===best.l && m.s===best.s) continue;
            const over = total-need;
            alts.push({h:m.h,l:m.l,s:m.s,totalServ:total,pans,over});
          }
        }
      }
      alts.sort((a,b)=> (a.over-b.over) || (a.pans-b.pans));
      const seen=new Set(); const out=[];
      for(const m of alts){
        const txt=mixToText(m);
        if(!seen.has(txt)){ out.push(m); seen.add(txt); }
        if(out.length>=3) break;
      }
      return out;
    }

    function render(){
      const s=compute();

      const courseTxt = (s.course==="dessert") ? "dessert plate"
                        : (s.course==="party") ? "sweets table (party)" : "coffee break or tasting";
      const appetiteTxt = $("appetite").selectedOptions[0].text.toLowerCase();
      const lengthTxt = $("length").selectedOptions[0].text.toLowerCase();
      const leftTxt = $("leftovers").selectedOptions[0].text.toLowerCase();
      const portionTxt = $("portion").selectedOptions[0].text.toLowerCase();

      // Micro-summary
      $("outMicro").textContent = s.guests>0
        ? (s.guests + " guests • " + courseTxt + " • " + appetiteTxt + " appetite • " + lengthTxt + " • leftovers " + leftTxt)
        : "-";

      // Big number + ARIA
      $("outBig").textContent = s.guests>0 ? (s.pans.toLocaleString() + " pan(s)") : "-";
      $("outBig").setAttribute("aria-label", s.guests>0 ? ("Estimated pans to buy: " + s.pans.toLocaleString()) : "No estimate yet");

      $("outServings").textContent = s.guests>0 ? s.servingsRounded.toLocaleString() : "-";

      const planTxt = s.guests>0 ? mixToText(s.mix) : "-";
      $("planLine").innerHTML = s.guests>0 ? ("Recommended pan plan: <strong>" + planTxt + "</strong>") : "-";
      $("outFrom").textContent = s.guests>0
        ? ("Estimated from " + s.guests + " guests - " + courseTxt + ", " + portionTxt + ", " + appetiteTxt + " appetite, " + lengthTxt + ", leftovers " + leftTxt + ".")
        : "-";

      // Warning (servings-based, pan-context)
      (function(){
        const noteEl=$("outBatchNote"); noteEl.textContent="";
        if(!s.guests) return;
        const total = s.mix.totalServ;
        const need = s.servingsRounded;
        const pans = s.pans;
        const over = Math.max(0, total - need);
        if(pans===1 && (total >= need*1.2 || over >= 5)){
          const first = mixToText(s.mix).split(" and ")[0];
          noteEl.textContent = "Minimum batch size: " + first + " is larger than you need — about " + over + " servings over. Leftovers expected.";
          return;
        }
        if(pans>=2 && (total >= need*1.3 || over >= 6)){
          noteEl.textContent = "Heads up: " + mixToText(s.mix) + " (" + total + " servings) is above what you need (" + need + " servings) by about " + over + " servings. Consider a smaller size or mixing sizes.";
        }
      })();

      // Pills
      $("pillGuests").textContent = s.guests>0 ? (s.guests + " guests") : "guests";
      $("pillPan").textContent = s.guests>0 ? planTxt : "-";
      $("pillPrice").textContent = "pricing optional";

      // Alternatives (collapsed unless meaningful overage)
      (function(){
        const wrap=$("altWrap"), link=$("toggleAlt"), body=$("altLine");
        if(!s.guests){ wrap.style.display="none"; body.style.display="none"; link.setAttribute("aria-expanded","false"); return; }
        const need = s.servingsRounded;
        if(shouldShowAlternatives(need, s.mix)){
          const alts = altPlans(need, s.mix);
          if(alts.length){
            const items = alts.map(m=> mixToText(m)+" ("+m.totalServ+" servings)").join(" • ");
            body.textContent = items;
            wrap.style.display = "";
            body.style.display = "none";
            link.textContent = "Show other options";
            link.setAttribute("aria-expanded","false");
            link.onclick = function(){
              const open = body.style.display !== "none";
              body.style.display = open ? "none" : "";
              link.textContent = open ? "Show other options" : "Hide other options";
              link.setAttribute("aria-expanded", String(!open));
            };
          } else {
            wrap.style.display="none"; body.style.display="none";
          }
        } else {
          wrap.style.display="none"; body.style.display="none";
        }
      })();

      // Pricing
      const mode = ($("priceMode")||{}).value || "pan";
      const unit = N($("priceUnit").value,0);
      const tax = N($("taxPct").value,0)/100;
      const fees = N($("fees").value,0);
      const qty = (mode==="pan") ? s.pans : s.servingsRounded;
      const subtotal = (unit>0 && qty>0) ? unit * qty : 0;
      const adds = subtotal*tax + (fees>0?fees:0);
      const totalCost = subtotal + adds;
      const ppp = (totalCost>0 && s.guests>0) ? (totalCost/s.guests) : NaN;
      $("outSubtotal").textContent = subtotal?money(subtotal):"$-";
      $("outAdds").textContent     = subtotal?money(adds):"$-";
      $("outTotal").textContent    = subtotal?money(totalCost):"$-";
      $("outPPP").textContent      = (totalCost>0 && s.guests>0)?money(ppp):"$-";
      $("pillPrice").textContent   = (totalCost>0 && s.guests>0)?("about "+money(ppp)+" per person"):"pricing optional";
    }

    // Wire events
    ["A","T","C","course","length","leftovers","appetite","portion","priceMode","priceUnit","taxPct","fees"].forEach(id=>{
      const el=$(id);
      if(el){ el.addEventListener("input", render); el.addEventListener("change", render); }
    });

    // Presets
    Array.from(document.querySelectorAll(".preset")).forEach(btn=>{
      btn.addEventListener("click",()=>{
        const n = parseInt(btn.getAttribute("data-people"),10)||0;
        $("A").value = String(n);
        $("T").value = "0";
        $("C").value = "0";
        render();
      });
    });

    // Reset
    $("dmReset").addEventListener("click", ()=>{
      $("A").value="10"; $("T").value="0"; $("C").value="0";
      $("course").value="dessert";
      $("length").value="1.00";
      $("leftovers").value="1.00";
      $("appetite").value="1.00";
      $("portion").value="1.00";
      ["priceUnit","taxPct","fees"].forEach(id=>{ const el=$(id); if(el) el.value=""; });
      $("priceMode").value="pan";
      render();
    });

    // Initial paint
    if(document.readyState==="loading") document.addEventListener("DOMContentLoaded", render, {once:true});
    else render();
  })();
  </script>

  <div class="muted" style="text-align:center;margin:16px 0 0 0;">
    This tool provides general portion and cost estimates for planning only. Results depend on the information you enter and typical averages.
    DinnerMath is not responsible for decisions, purchases, or outcomes based on these estimates.<br>
    © 2025 DinnerMath. All rights reserved. Use for planning only.
  </div>
</body>
</html>
